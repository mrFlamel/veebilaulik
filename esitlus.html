<!DOCTYPE html>
<html id="avaleht">
<head>
<title>Veebilaulik</title>
<link rel="icon" type="image/x-icon" href="favicon.webp">
<link rel="stylesheet" href="style.css">
<script src="lib/papaparse.min.js"></script>
<script src="tools.js"></script>
<script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs/dist/pptxgen.bundle.js"></script>
<script>const lauluNimi = findGetParameter("laul");</script>
<meta charset="UTF-8">
</head>
<body>
<div class="header">
  <a href="index.html" class="logo">Veebilaulik</a>
  <form id="topbarSearch" action="search.html" method="get">
  		<div class="embed-submit-field">
  			<input id="topbarOtsimisVali" type="text" id="searchTerm" name="searchTerm" placeholder="Otsi laulu pealkirja, autorit, numbrit">
  			<button id="topbarOtsimisKinnitus" type="submit" value="Submit">Otsi</button>
  		</div>
  </form>
</div>

<div id="looEsitlus">
	<h1>Loo esitlus:</h1>
	<input id="lauluOtsing" type="text" placeholder="Laulude nimed ', ' eraldatud "><br>
	<input id="fondiNimi" type="text" placeholder="Fondi nimi"><br>
	<input id="fondiSuurus" type="text" placeholder="Fondi suurus"><br>
	<input id="tekstiVarv" type="text" placeholder="Teksti v채rv (HEX)"><br>
	<input id="taustaVarv" type="text" placeholder="Tausta v채rv (HEX)"><br>
	<input id="topeltRida" type="checkbox"> 2 rida 체hel slaidil (Vaikimisi: 1)<br>
	<button onclick="looEsitlus()">Loo esitlus</button>
</div>
<script>
// LISA GET PARAMEETER OTSINGUSSE
document.getElementById("lauluOtsing").value = lauluNimi;

function hangiSonad(lauluNimiInner){

	fetch("/akordifailid/" + lauluNimiInner + ".txt")
	.then(response => {
		if (!response.ok){
			throw new Error("Laulu avamine eba천nnestus.")
		} else {
			return response.text()
		}
	})
	.then(text => {
		tuhiSlaid(pres)
		uusLaul(text)
		if (lauluNimiInner == viimane){
			pres.writeFile({ fileName: "Esitlus - VEEBILAULIK.pptx" });
		}
	})
}

function uusLaul(sonad){
	let sonadToot = sonad.replace(/[\r]+/g, "")
	const read = sonadToot.split("\n")



	var kasOnAkordid = true;
	var juurdeLisada = ""
	for (i in read){
		if (read[i] == ""){continue}
		if (read[i].startsWith("[")){
			if (topeltRida){
				if (juurdeLisada == ""){continue}
				pres = uusSlaid(juurdeLisada.toUpperCase(), pres)
				juurdeLisada = ""
			}
			continue
		}

		if (kasOnAkordid){
			kasOnAkordid = false;
			continue
		} else {
			kasOnAkordid = true
			
			if (topeltRida){
				if (juurdeLisada == ""){
					juurdeLisada = read[i];
				} else {
					let tekst = juurdeLisada + "\n" + read[i];
					pres = uusSlaid(tekst.toUpperCase(), pres)
					juurdeLisada = ""
				}
			} else {
				let tekst = read[i].replace(/[.,\/#!$%\^&\*;:{}=\_`~()]+$/g,"");
				pres = uusSlaid(tekst.toUpperCase(), pres)
			}
			
		}
	}

	if (topeltRida && juurdeLisada != ""){
		let tekst = juurdeLisada;
		pres = uusSlaid(tekst.toUpperCase(), pres)
		juurdeLisada = ""
	}

}

var pres = new PptxGenJS();
let topeltRida = true;
var taust = "#e8e6e0"
var tekst = "#000000"
var font = "Bebas Neue"
var fondiSuurus = "36"
var laulud = ['palju-pohjust-laulmiseks', 'jeesus-jeesus', 'tanan_sind'];
var viimane = "";

function looEsitlus(){
	laulud = document.getElementById("lauluOtsing").value.split(", ")
	viimane = laulud.pop()
	laulud.push(viimane)

	taust = document.getElementById("taustaVarv").value;
	tekst = document.getElementById("tekstiVarv").value;
	font = document.getElementById("fondiNimi").value;
	fondiSuurus = document.getElementById("fondiSuurus").value;
	topeltRida = document.getElementById("topeltRida").checked;
	

	for (i in laulud){
		hangiSonad(laulud[i]);
	}
}


function uusSlaid(tekst, esitlus){
	let slide = esitlus.addSlide();
	let textboxOpts = { x: '15%', y: '0%', w: '70%', h: "95%", color: tekst, align: "center", fontSize: parseInt(fondiSuurus), fontFace: font };
	slide.addText(tekst, textboxOpts);
	slide.background = { color: taust };
	return esitlus
}
function tuhiSlaid(esitlus){
	let slide = esitlus.addSlide()
	slide.background = { color: taust };
	return esitlus
}



</script>
<!-- EMPTY SPACE FILLER -->
<div style="height:100%"></div>
<div class="footer">
  <a href="kuidas_kasutada.html" class="footerLink">Kuidas kasutada</a>
  <a href="teemad.html" class="footerLink">Temaatiline jaotus</a>
  <a href="panusta.html" class="footerLink">Panusta</a>
  <a href="meist.html" class="footerLink">Meist</a>
  <a href="kontakt.html" class="footerLink">Kontakt</a>
  <a href="tingimused.html" class="footerLink">Kasutustingimused</a>
</div>


</body>
</html>