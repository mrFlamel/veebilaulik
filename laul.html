<!DOCTYPE html>
<html>
<head>
<title>Veebilaulik</title>
<link rel="stylesheet" href="style.css">
<script src="lib/chordsheetjs.js"></script>
<script src="tools.js"></script>
<meta charset="UTF-8">
</head>
<body>


<div class="header">
  <a href="index.html" class="logo">Veebilaulik</a>
  <form id="topbarSearch" action="search.html" method="get">
  		<div class="embed-submit-field">
  			<input id="topbarOtsimisVali" type="text" id="searchTerm" name="searchTerm" placeholder="Otsi laulu pealkirja, autorit, numbrit">
  			<button id="topbarOtsimisKinnitus" type="submit" value="Submit">Otsi</button>
  		</div>
  </form>
</div>




<div id="nupuDiv">
	<button id="tagasiNupp" class="suurNupp" onclick="tagasi()">Tagasi</button>
	<div>
		<button id="prindiNupp" class="suurNupp">Prindi</button>
		<button id="esitluseNupp" class="suurNupp">Loo esitlus</button>
	</div>
</div>





<div id="lauluContainer">
	<div>
		<div id="lauluInfo">
			<h1 id="lauluPealkiri">Suur Issand, Sa!</h1>
			<h2 id="originaalPealkiri">Great are you Lord #0001</h2>
			<i>
				Autor: All Sons & Daughters<br>
				Autori천igused: All Sons & Daughters<br>
				T천lge: Jakob Luhamets	
			</i>
		</div>
		<div id="lauluDiv"></div>
	</div>

	<div id="valikuDiv">
		<select class="dropdown" id ="helistik" name="helistik" onclick="kontrolliMuutust(this.value)" onchange="transposeSong(this.value);">
  			<option value='1'>A-duur</option>
  			<option value='2'>A#-duur</option>
  			<option value='3'>B-duur</option>
  			<option value='4'>C-duur</option>
  			<option value='5'>C#-duur</option>
  			<option value='6'>D-duur</option>
  			<option value='7'>D#-duur</option>
  			<option value='8'>E-duur</option>
  			<option value='9'>F-duur</option>
  			<option value='10'>F#-duur</option>
		</select><br>
		<select class="dropdown" id="keel" name="keel" onchange="muudaKeelt(this.value);">
  			<option value='eesti'>Eesti keel</option>
  			<option value='inglise'>Inglise keel</option>
		</select>
	</div>
</div>

<script>
	fetch("chordsheets/" + findGetParameter("pealkiri") + ".txt")
		.then(response => {
			if (!response.ok){
				throw new Error("S천nade hankimine eba천nnestus")
			} else {
				return response.text()
			}
		})
		.then(text => {
			showLyrics(text)
		})

	var song;
	function showLyrics(text){
		const parser = new ChordSheetJS.ChordsOverWordsParser();
		song = parser.parse(text);
		const formatter = new ChordSheetJS.HtmlTableFormatter();
		const disp = formatter.format(song);
		document.getElementById('lauluDiv').innerHTML = disp;
	}

	document.getElementById("helistik").value = '1';
	var praeguneHelistik = '1';
	var votmemargid = "#";
	function transposeSong(sihtHelistik){
		const amount = sihtHelistik - praeguneHelistik;
		song = song.transpose(amount);

		if (amount == 0){
			if (votmemargid == "#"){
				song = song.useModifier("b");
				votmemargid = "b";
			} else {
				song = song.useModifier("#")
				votmemargid = "#";
			}
		}

		const formatter = new ChordSheetJS.HtmlTableFormatter();
		const disp = formatter.format(song);
		document.getElementById('lauluDiv').innerHTML = disp;
		praeguneHelistik = sihtHelistik;
	}

	function kontrolliMuutust(helistik){ //Veel katki
		if (helistik == praeguneHelistik){
			transposeSong(helistik);
		}
	}


	function tagasi(){
		if (document.referrer.includes("search.html")){
			history.back()
		} else {
			window.open("index.html","_self")
		}
	}
	function muudaKeelt(keel){
		alert("Pole veel saadaval!")
	}
</script>




<div class="footer">
  <a href="meist.html" class="footerLink">Meist</a>
  <a href="toeta.html" class="footerLink">Toeta</a>
  <a href="kontakt.html" class="footerLink">Kontakt</a>
  <a href="teemad.html" class="footerLink">Temaatiline jaotus</a>
  <a href="panusta.html" class="footerLink">Panusta</a>
  <a href="tingimused.html" class="footerLink">Kasutustingimused</a>
</div>



</body>
</html>